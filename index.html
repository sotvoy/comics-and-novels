<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Comics & Novels</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{margin:0;background:#0f1114;color:#fff;font-family:Arial}
header,footer{background:#181b1e;padding:10px;display:flex;justify-content:space-between;align-items:center}
button{background:#1db954;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
main{padding:15px}
.card{background:#1f2226;padding:10px;border-radius:10px;margin-bottom:10px}
input,textarea{width:100%;padding:8px;margin-bottom:8px;border-radius:6px;border:none}
.hidden{display:none}
</style>
</head>

<body>

<header>
  <b>üìö Comics & Novels</b>
  <div>
    <button onclick="showLogin()">Login</button>
    <button onclick="showPublish()">+</button>
  </div>
</header>

<main>
  <input id="search" placeholder="Search..." oninput="render()" />
  <div id="feed"></div>
</main>

<footer>
  <span id="userStatus">Not logged in</span>
</footer>

<!-- LOGIN -->
<div id="loginModal" class="hidden">
  <div class="card">
    <input id="email" placeholder="Email">
    <input id="password" placeholder="Password" type="password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
  </div>
</div>

<!-- PUBLISH -->
<div id="publishModal" class="hidden">
  <div class="card">
    <input id="title" placeholder="Title">
    <textarea id="content" placeholder="Chapter content (text for novels)"></textarea>
    <input type="file" id="images" multiple>
    <button onclick="publish()">Publish</button>
  </div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCPp44zUE1rYsIpiiNq1DjRpXvJFA-zr4g",
  authDomain: "comics-and-novels.firebaseapp.com",
  projectId: "comics-and-novels",
  storageBucket: "comics-and-novels.appspot.com",
});
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let user = null;

/* AUTH */
auth.onAuthStateChanged(u=>{
  user=u;
  document.getElementById("userStatus").innerText =
    u ? "Logged in as "+u.email : "Not logged in";
  render();
});

function login(){
  auth.signInWithEmailAndPassword(
    email.value,password.value
  ).then(()=>hideAll());
}
function register(){
  auth.createUserWithEmailAndPassword(
    email.value,password.value
  ).then(()=>hideAll());
}

/* UI */
function showLogin(){hideAll();loginModal.classList.remove("hidden")}
function showPublish(){
  if(!user) return alert("Login first");
  hideAll();publishModal.classList.remove("hidden");
}
function hideAll(){
  loginModal.classList.add("hidden");
  publishModal.classList.add("hidden");
}

/* PUBLISH */
async function publish(){
  const doc = await db.collection("series").add({
    title:title.value,
    author:user.uid,
    created:Date.now(),
    likes:0
  });

  if(images.files.length){
    for(const file of images.files){
      const ref = storage.ref(`series/${doc.id}/${file.name}`);
      await ref.put(file);
    }
  } else {
    await db.collection("chapters").add({
      series:doc.id,
      text:content.value
    });
  }
  hideAll(); render();
}

/* FEED */
async function render(){
  feed.innerHTML="Loading...";
  const q = search.value.toLowerCase();
  const snap = await db.collection("series").orderBy("created","desc").get();
  feed.innerHTML="";
  snap.forEach(d=>{
    if(!d.data().title.toLowerCase().includes(q)) return;
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <b>${d.data().title}</b><br>
      ‚ù§Ô∏è ${d.data().likes}
      <button onclick="like('${d.id}')">Like</button>
    `;
    feed.appendChild(div);
  });
}

/* LIKE */
function like(id){
  db.collection("series").doc(id)
    .update({likes:firebase.firestore.FieldValue.increment(1)});
  render();
}
</script>

</body>
  </html>
